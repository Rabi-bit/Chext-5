<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CHEXT DIGITAL | AI-OS</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --bg: #000000; --accent: #00ff88; --rabi: #bc13fe; --glass: rgba(255,255,255,0.05); }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: #fff; margin: 0; overflow-x: hidden; }
        
        /* Layout */
        .page { display: none; padding: 20px; min-height: 100vh; animation: fadeIn 0.4s ease; }
        .active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Components */
        .glass-card { background: var(--glass); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 20px; margin-bottom: 20px; backdrop-filter: blur(10px); }
        input, select { width: 100%; padding: 15px; margin: 10px 0; border-radius: 12px; border: 1px solid #333; background: #111; color: #fff; box-sizing: border-box; }
        button { width: 100%; padding: 16px; border-radius: 30px; border: none; font-weight: 800; cursor: pointer; transition: 0.3s; margin-top: 10px; text-transform: uppercase; letter-spacing: 1px; }
        .btn-main { background: var(--accent); color: #000; }
        .btn-rabi { background: var(--rabi); color: #fff; }

        /* AI Elements */
        .ai-status { font-size: 10px; color: var(--accent); letter-spacing: 2px; text-align: center; margin-bottom: 20px; }
        .pulse { animation: pulse-red 2s infinite; }
        @keyframes pulse-red { 0% { box-shadow: 0 0 0 0 rgba(0, 255, 136, 0.4); } 70% { box-shadow: 0 0 0 15px rgba(0, 255, 136, 0); } 100% { box-shadow: 0 0 0 0 rgba(0, 255, 136, 0); } }
        
        /* Dashboard Widgets */
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .mini-card { background: #111; padding: 15px; border-radius: 12px; border: 1px solid #222; font-size: 12px; }
    </style>
</head>
<body>

<div id="ai_notifier" style="position:fixed; bottom:20px; left:50%; transform:translateX(-50%); background:var(--accent); color:#000; padding:10px 20px; border-radius:20px; font-weight:bold; z-index:9999; display:none;">AI: OPTIMIZING CORE...</div>

<div id="splashPage" class="page active" style="display:flex; flex-direction:column; justify-content:center; align-items:center; text-align:center;">
    <h1 style="font-size:3rem; letter-spacing:10px; margin-bottom:0; color:var(--accent);">CHEXT</h1>
    <p style="letter-spacing:5px; opacity:0.5; margin-top:5px;">DIGITAL OS</p>
    <div class="ai-status">ADAPTIVE INTELLIGENCE ACTIVE</div>
    <button onclick="nav('loginPage')" class="btn-main" style="width:250px;">INITIALIZE</button>
</div>

<div id="loginPage" class="page">
    <div class="glass-card" style="max-width:400px; margin:auto; margin-top:15vh;">
        <h2 id="loginTitle">System Auth</h2>
        <div id="auth_step1">
            <input type="text" id="user" placeholder="Identity">
            <input type="password" id="pass" placeholder="Secret Key">
            <button onclick="initOTP()" class="btn-main">Get OTP</button>
            <p onclick="nav('adminRegPage')" style="text-align:center; font-size:12px; color:var(--accent); margin-top:15px;">New Admin? Create Organization</p>
        </div>
        <div id="auth_step2" style="display:none;">
            <p style="color:var(--accent); text-align:center;">OTP: <span id="otp_val">0000</span></p>
            <input type="number" id="otp_input" placeholder="Enter 4-digit code">
            <button onclick="finalizeLogin()" class="btn-main">Verify & Enter</button>
        </div>
    </div>
</div>

<div id="creatorPage" class="page">
    <div style="display:flex; justify-content:space-between; align-items:center;">
        <h2 style="color:var(--rabi)">GOD MODE: RABI</h2>
        <button onclick="location.reload()" style="width:70px; font-size:10px; background:#333;">OUT</button>
    </div>
    
    <div class="glass-card pulse">
        <h3>Master Billing & AI Config</h3>
        <label>Admin Access Fee ($)</label>
        <input type="number" id="bill_rate" value="50">
        <label>System-Wide API Key</label>
        <input type="text" id="master_api" placeholder="NEWS/WEATHER KEY">
        <button class="btn-rabi" onclick="aiAlert('Global System Updated')">Deploy Settings</button>
    </div>

    <h3>Active Tenants</h3>
    <div id="tenant_list"></div>
</div>

<div id="adminPage" class="page">
    <div class="stat-grid">
        <div class="mini-card" id="weather">Weather: Syncing...</div>
        <div class="mini-card" id="news">News: Fetching...</div>
    </div>

    <h2 id="org_title">Admin Control</h2>
    <div class="glass-card">
        <h3>Register Worker</h3>
        <input type="text" id="wn" placeholder="Worker Name">
        <input type="text" id="wr" placeholder="Role (e.g. Sales)">
        <button onclick="addWorker()" class="btn-main">Create & Send Link</button>
    </div>

    <div class="glass-card">
        <h3>Workload & Exchange</h3>
        <canvas id="adminChart" height="150"></canvas>
    </div>
</div>

<div id="workerPage" class="page">
    <h2 id="worker_title">Worker Node</h2>
    <div class="glass-card pulse">
        <h3>Live GPS Tracking</h3>
        <p id="gps_data">Awaiting Permission...</p>
        <button onclick="trackGPS()" class="btn-main">Check-In</button>
    </div>

    <div class="glass-card">
        <h3>Tasks & Progress</h3>
        <div id="task_list">No tasks assigned.</div>
        <input type="range" min="0" max="100" id="prog">
        <button onclick="aiAlert('Progress Saved to Admin')" class="btn-main" style="background:#555;">Sync Status</button>
    </div>
</div>

<div id="adminRegPage" class="page">
    <div class="glass-card">
        <h2>New Organization</h2>
        <input type="text" id="new_org" placeholder="Org Name">
        <input type="text" id="new_user" placeholder="Admin User">
        <input type="password" id="new_pass" placeholder="Admin Pass">
        <button onclick="regAdmin()" class="btn-main">Register Organization</button>
    </div>
</div>

<script>
    // --- DATABASE & STATE ---
    let db = {
        admins: JSON.parse(localStorage.getItem('cx_admins')) || [],
        workers: JSON.parse(localStorage.getItem('cx_workers')) || [],
        session: null,
        otp: "0000"
    };

    function nav(id) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        window.scrollTo(0,0);
    }

    function aiAlert(msg) {
        const box = document.getElementById('ai_notifier');
        box.innerText = "AI: " + msg;
        box.style.display = 'block';
        setTimeout(() => box.style.display = 'none', 3000);
    }

    // --- AUTH FLOW ---
    function initOTP() {
        const u = document.getElementById('user').value;
        const p = document.getElementById('pass').value;
        if(!u || !p) return alert("Fill credentials");

        db.otp = Math.floor(1000 + Math.random() * 9000).toString();
        document.getElementById('otp_val').innerText = db.otp;
        document.getElementById('auth_step1').style.display = 'none';
        document.getElementById('auth_step2').style.display = 'block';
        aiAlert("Verification Code Dispatched");
    }

    function finalizeLogin() {
        const input = document.getElementById('otp_input').value;
        if(input !== db.otp) return alert("Wrong OTP");

        const u = document.getElementById('user').value;
        const p = document.getElementById('pass').value;

        if(u === 'Rabi' && p === '3400') {
            renderCreator();
            nav('creatorPage');
        } else {
            let a = db.admins.find(x => x.user === u && x.pass === p);
            let w = db.workers.find(x => x.name === u);
            
            if(a) { db.session = a; document.getElementById('org_title').innerText = a.org; renderAdmin(); nav('adminPage'); }
            else if(w) { db.session = w; document.getElementById('worker_title').innerText = w.name; nav('workerPage'); }
            else alert("User not found");
        }
    }

    // --- LOGIC ---
    function regAdmin() {
        db.admins.push({
            org: document.getElementById('new_org').value,
            user: document.getElementById('new_user').value,
            pass: document.getElementById('new_pass').value
        });
        localStorage.setItem('cx_admins', JSON.stringify(db.admins));
        aiAlert("Organization Live");
        nav('loginPage');
    }

    function addWorker() {
        const w = { name: document.getElementById('wn').value, role: document.getElementById('wr').value, org: db.session.org };
        db.workers.push(w);
        localStorage.setItem('cx_workers', JSON.stringify(db.workers));
        aiAlert("Worker Link Generated & Sent");
    }

    function trackGPS() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(pos => {
                document.getElementById('gps_data').innerText = `LAT: ${pos.coords.latitude.toFixed(4)} | LNG: ${pos.coords.longitude.toFixed(4)}`;
                aiAlert("Location Verified by AI");
            });
        }
    }

    function renderCreator() {
        const list = document.getElementById('tenant_list');
        list.innerHTML = db.admins.map(a => `<div class='glass-card'>${a.org} (Admin: ${a.user})</div>`).join('');
    }

    function renderAdmin() {
        const ctx = document.getElementById('adminChart').getContext('2d');
        new Chart(ctx, {
            type: 'line',
            data: { labels: ['Jan', 'Feb', 'Mar'], datasets: [{ label: 'Performance', data: [12, 19, 15], borderColor: '#00ff88' }] },
            options: { color: '#fff' }
        });
        // Simulated AI Widgets
        document.getElementById('weather').innerText = "London: 12Â°C, Rain";
        document.getElementById('news').innerText = "Live: Tech Stocks Up 2%";
    }
</script>
</body>
      </html>
