<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CHEXT DIGITAL | UNIVERSAL OS</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --bg: #000; --accent: #00ff88; --rabi-purp: #bc13fe; --admin-blue: #0084ff; --worker-gold: #ffcc00; --card: #111; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: #fff; margin: 0; padding: 0; }
        
        /* Navigation Controller */
        .page { display: none; min-height: 100vh; padding: 20px; width: 100%; }
        .active { display: block !important; }

        /* UI Kit */
        .glass { background: var(--card); border: 1px solid #222; border-radius: 20px; padding: 20px; margin-bottom: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .ai-pulse { border: 1px solid var(--accent); animation: pulse 2s infinite; }
        @keyframes pulse { 0% { box-shadow: 0 0 5px var(--accent); } 50% { box-shadow: 0 0 20px var(--accent); } 100% { box-shadow: 0 0 5px var(--accent); } }
        
        input, select, textarea { width: 100%; padding: 15px; margin: 10px 0; border-radius: 12px; border: 1px solid #333; background: #050505; color: #fff; font-size: 16px; }
        button { width: 100%; padding: 16px; border-radius: 30px; border: none; font-weight: bold; cursor: pointer; transition: 0.2s; margin-top: 10px; font-size: 14px; text-transform: uppercase; }
        .btn-main { background: var(--accent); color: #000; }
        .btn-rabi { background: var(--rabi-purp); color: #fff; }
        
        .nav-tabs { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 10px; margin-bottom: 15px; }
        .tab { background: #222; padding: 8px 15px; border-radius: 20px; font-size: 12px; white-space: nowrap; border: 1px solid #444; }
        .widget-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .widget { background: #0a0a0a; padding: 12px; border-radius: 12px; border: 1px solid #222; font-size: 11px; }
    </style>
</head>
<body>

<div id="ai_alert" style="position:fixed; top:20px; left:50%; transform:translateX(-50%); background:var(--accent); color:#000; padding:10px 25px; border-radius:30px; font-weight:bold; z-index:9999; display:none;">AI: SYNCHRONIZING CORE</div>

<div id="splashPage" class="page active">
    <div style="height:90vh; display:flex; flex-direction:column; justify-content:center; align-items:center; text-align:center;">
        <h1 style="font-size:3.5rem; letter-spacing:10px; color:var(--accent); margin:0;">CHEXT</h1>
        <p style="opacity:0.5; letter-spacing:5px;">DIGITAL OS</p>
        <button onclick="show('loginPage')" class="btn-main" style="width:220px; margin-top:50px;">INITIALIZE</button>
    </div>
</div>

<div id="loginPage" class="page">
    <div class="glass" style="max-width:450px; margin: 10vh auto;">
        <h2 style="text-align:center;">Security Gate</h2>
        <div id="auth_1">
            <input type="text" id="log_u" placeholder="Username">
            <input type="password" id="log_p" placeholder="Password">
            <button onclick="requestOTP()" class="btn-main">Verify Credentials</button>
            <p onclick="show('regPage')" style="text-align:center; color:var(--accent); cursor:pointer; font-size:12px; margin-top:20px;">Register New Organization</p>
        </div>
        <div id="auth_2" style="display:none; text-align:center;">
            <p>OTP Code Sent: <b id="otp_val" style="color:var(--accent)">0000</b></p>
            <input type="number" id="otp_in" placeholder="4-Digit OTP">
            <button onclick="handleLogin()" class="btn-main">Enter OS</button>
        </div>
    </div>
</div>

<div id="creatorPage" class="page">
    <div style="display:flex; justify-content:space-between; align-items:center;">
        <h2 style="color:var(--rabi-purp)">CREATOR: RABI</h2>
        <button onclick="location.reload()" style="width:70px; font-size:10px; background:#444;">OUT</button>
    </div>
    <div class="glass ai-pulse">
        <h3>System Settings & Billing</h3>
        <label>Global Admin Fee ($/mo)</label>
        <input type="number" id="global_fee" value="50">
        <label>Inject Global Code (AI Adaptation)</label>
        <textarea id="ai_inject" placeholder="// Deploy global JS rules..."></textarea>
        <button onclick="deployGlobal()" class="btn-rabi">Push Evolution</button>
    </div>
    <h3>Global Monitoring</h3>
    <div id="master_list"></div>
</div>

<div id="adminPage" class="page">
    <div class="widget-grid">
        <div class="widget" id="live_weather">Weather: 24Â°C / Sunny</div>
        <div class="widget" id="live_news">News: Global Markets Stable</div>
    </div>
    <h2 id="adm_org_title" style="color:var(--admin-blue)">Admin Portal</h2>
    <div class="nav-tabs">
        <div class="tab" onclick="admTab('staff')">Manage Staff</div>
        <div class="tab" onclick="admTab('tasks')">Set Work</div>
        <div class="tab" onclick="admTab('bank')">Banking/Rates</div>
    </div>

    <div id="adm_staff" class="adm-content">
        <div class="glass">
            <h4>Register Worker</h4>
            <input type="text" id="wn" placeholder="Full Name">
            <input type="text" id="wr" placeholder="Role (Teacher, Driver, etc)">
            <button onclick="addWorker()" class="btn-main">Generate & Send Link</button>
        </div>
        <div id="staff_display"></div>
    </div>

    <div id="adm_tasks" class="adm-content" style="display:none;">
        <div class="glass">
            <h4>Set Work Progress Target</h4>
            <select id="task_cycle"><option>Daily</option><option>Weekly</option><option>Monthly</option><option>Yearly</option></select>
            <textarea id="task_desc" placeholder="Describe work required..."></textarea>
            <button onclick="setTask()" class="btn-main">Deploy Task</button>
        </div>
    </div>

    <div id="adm_bank" class="adm-content" style="display:none;">
        <div class="glass">
            <h4>International Exchange Rates</h4>
            <canvas id="rateChart" height="200"></canvas>
        </div>
    </div>
</div>

<div id="workerPage" class="page">
    <h2 id="wrk_name" style="color:var(--worker-gold)">Worker Node</h2>
    <div class="glass ai-pulse">
        <h3>Live GPS Logistics</h3>
        <div id="gps_data" style="font-family:monospace; color:var(--accent);">GPS: INACTIVE</div>
        <button onclick="trackGPS()" class="btn-main">Sync Location</button>
    </div>
    <div class="glass">
        <h3>Work Progress</h3>
        <div id="wrk_task_list" style="margin-bottom:15px; color:var(--accent);">Awaiting Task...</div>
        <input type="range" id="prog_slider" min="0" max="100" value="0">
        <button onclick="updateProgress()" class="btn-main" style="background:#333;">Upload Progress</button>
    </div>
    <div class="glass">
        <h3>AI Communication</h3>
        <div id="chat" style="height:100px; overflow-y:auto; font-size:12px;"></div>
        <input type="text" id="msg" placeholder="Talk to Admin/AI...">
        <button onclick="sendMsg()" class="btn-main" style="font-size:10px; padding:10px;">Send</button>
    </div>
</div>

<div id="regPage" class="page">
    <div class="glass" style="margin-top:10vh;">
        <h2>Org Registration</h2>
        <input type="text" id="ro" placeholder="Organization Name">
        <input type="text" id="ru" placeholder="Admin Username">
        <input type="password" id="rp" placeholder="Admin Password">
        <button onclick="saveAdmin()" class="btn-main">Launch Site</button>
    </div>
</div>

<script>
    // --- PERSISTENCE LAYER ---
    let db = {
        admins: JSON.parse(localStorage.getItem('chx_adm')) || [],
        workers: JSON.parse(localStorage.getItem('chx_wrk')) || [],
        tasks: JSON.parse(localStorage.getItem('chx_tsk')) || [],
        otp: "0000", cur: null
    };

    function show(id) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        window.scrollTo(0,0);
    }

    function ai(m) {
        const b = document.getElementById('ai_alert');
        b.innerText = "AI: " + m;
        b.style.display = 'block';
        setTimeout(() => b.style.display='none', 3000);
    }

    // --- AUTH ---
    function requestOTP() {
        const u = document.getElementById('log_u').value;
        const p = document.getElementById('log_p').value;
        if(!u || !p) return alert("Credentials Missing");
        
        db.otp = (u === 'Rabi' && p === '3400') ? "3400" : Math.floor(1000 + Math.random() * 9000).toString();
        document.getElementById('otp_val').innerText = db.otp;
        document.getElementById('auth_1').style.display = 'none';
        document.getElementById('auth_2').style.display = 'block';
        ai("OTP DISPATCHED");
    }

    function handleLogin() {
        if(document.getElementById('otp_in').value !== db.otp) return alert("Auth Failed");
        const u = document.getElementById('log_u').value;
        const p = document.getElementById('log_p').value;

        if(u === 'Rabi' && p === '3400') {
            renderCreator();
            show('creatorPage');
        } else {
            let a = db.admins.find(x => x.u === u && x.p === p);
            let w = db.workers.find(x => x.n === u);
            if(a) { db.cur = a; document.getElementById('adm_org_title').innerText = a.o; show('adminPage'); }
            else if(w) { db.cur = w; document.getElementById('wrk_name').innerText = w.n; renderWrkTasks(); show('workerPage'); }
            else alert("Account Not Found");
        }
    }

    // --- LOGIC ---
    function saveAdmin() {
        const o = document.getElementById('ro').value;
        const u = document.getElementById('ru').value;
        const p = document.getElementById('rp').value;
        db.admins.push({o, u, p});
        localStorage.setItem('chx_adm', JSON.stringify(db.admins));
        ai("Organization Registered");
        show('loginPage');
    }

    function addWorker() {
        const n = document.getElementById('wn').value;
        const r = document.getElementById('wr').value;
        db.workers.push({n, r, o: db.cur.o});
        localStorage.setItem('chx_workers', JSON.stringify(db.workers));
        ai("Link Generated for " + n);
    }

    function setTask() {
        const c = document.getElementById('task_cycle').value;
        const d = document.getElementById('task_desc').value;
        db.tasks.push({o: db.cur.o, c, d});
        localStorage.setItem('chx_tsk', JSON.stringify(db.tasks));
        ai("Task Deployed to Workers");
    }

    function trackGPS() {
        if(navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(p => {
                document.getElementById('gps_data').innerText = `LAT: ${p.coords.latitude.toFixed(4)} | LNG: ${p.coords.longitude.toFixed(4)}`;
                ai("Location Synced");
            });
        }
    }

    function admTab(t) {
        document.querySelectorAll('.adm-content').forEach(c => c.style.display='none');
        document.getElementById('adm_'+t).style.display='block';
        if(t === 'bank') renderBank();
    }

    function renderBank() {
        const ctx = document.getElementById('rateChart').getContext('2d');
        new Chart(ctx, { type:'line', data:{ labels:['1d','2d','3d','4d'], datasets:[{label:'Ex-Rate', data:[1.1,1.4,1.3,1.6], borderColor:'#00ff88'}]}, options:{color:'#fff'}});
    }

    function renderWrkTasks() {
        const t = db.tasks.find(x => x.o === db.cur.o);
        if(t) document.getElementById('wrk_task_list').innerText = `[${t.c}] ${t.d}`;
    }

    function renderCreator() {
        document.getElementById('master_list').innerHTML = db.admins.map(a => `<div class="glass">${a.o} (Admin: ${a.u})</div>`).join('');
    }

    function deployGlobal() {
        eval(document.getElementById('ai_inject').value);
        ai("System Logic Re-Written");
    }

    function logout() { location.reload(); }
</script>
</body>
            </html>
