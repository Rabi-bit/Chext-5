<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CHEXT DIGITAL | AI-OS</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --bg: #000; --accent: #00ff88; --rabi: #bc13fe; --admin: #0084ff; --worker: #f1c40f; --card: #111; }
        * { box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background: var(--bg); color: #fff; margin: 0; overflow-x: hidden; }
        .page { display: none; min-height: 100vh; padding: 20px; width: 100%; }
        .active { display: block !important; }
        .glass { background: var(--card); border: 1px solid #222; border-radius: 20px; padding: 20px; margin-bottom: 20px; }
        input, select, textarea { width: 100%; padding: 15px; margin: 10px 0; border-radius: 12px; border: 1px solid #333; background: #050505; color: #fff; font-size: 16px; }
        button { width: 100%; padding: 16px; border-radius: 30px; border: none; font-weight: bold; cursor: pointer; transition: 0.2s; margin-top: 10px; font-size: 14px; text-transform: uppercase; }
        .btn-acc { background: var(--accent); color: #000; }
        .btn-rabi { background: var(--rabi); color: #fff; }
        .nav-tabs { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 10px; }
        .tab { background: #222; padding: 8px 15px; border-radius: 20px; font-size: 11px; white-space: nowrap; border: 1px solid #444; }
        .status-dot { height: 10px; width: 10px; border-radius: 50%; display: inline-block; margin-right: 5px; }
    </style>
</head>
<body>

<div id="ai_notifier" style="position:fixed; top:20px; left:50%; transform:translateX(-50%); background:var(--accent); color:#000; padding:10px 25px; border-radius:30px; font-weight:bold; z-index:9999; display:none;">AI: OPTIMIZING...</div>

<div id="splashPage" class="page active" style="text-align:center; padding-top:30vh;">
    <h1 style="font-size:3.5rem; letter-spacing:10px; color:var(--accent); margin:0;">CHEXT</h1>
    <p style="opacity:0.5; letter-spacing:5px;">DIGITAL OS</p>
    <button onclick="nav('loginPage')" class="btn-acc" style="width:200px; margin-top:40px;">OPEN SYSTEM</button>
</div>

<div id="loginPage" class="page">
    <div class="glass" style="max-width:400px; margin: 10vh auto;">
        <h2 style="text-align:center;">Security Gate</h2>
        <div id="step1">
            <input type="text" id="l_u" placeholder="Username">
            <input type="password" id="l_p" placeholder="Password">
            <button onclick="getOTP()" class="btn-acc">Verify</button>
            <p onclick="nav('regPage')" style="text-align:center; color:var(--accent); cursor:pointer; font-size:12px; margin-top:15px;">Admin? Register Org</p>
        </div>
        <div id="step2" style="display:none; text-align:center;">
            <p>Verification Code: <b id="otp_display" style="color:var(--accent)">0000</b></p>
            <input type="number" id="otp_in" placeholder="Enter Code">
            <button onclick="verifyLogin()" class="btn-acc">Enter Dashboard</button>
        </div>
    </div>
</div>

<div id="creatorPage" class="page">
    <div style="display:flex; justify-content:space-between; align-items:center;">
        <h2 style="color:var(--rabi)">Creator: Rabi</h2>
        <button onclick="location.reload()" style="width:70px; font-size:10px; background:#444;">OUT</button>
    </div>
    <div class="glass" style="border: 2px solid var(--rabi);">
        <h3>Global Settings (Manual)</h3>
        <label>Monthly Subscription Fee ($)</label>
        <input type="number" id="global_fee" value="50">
        <label>System Maintenance</label>
        <select id="sys_status"><option>Active</option><option>Offline</option></select>
        <label>Global Code Injection (AI Evolution)</label>
        <textarea id="ai_code" placeholder="Paste JS logic here..."></textarea>
        <button onclick="deployAI()" class="btn-rabi">Push Changes</button>
    </div>
    <h3>Managed Admins & Billing</h3>
    <div id="master_list"></div>
</div>

<div id="adminPage" class="page">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
        <h2 id="adm_title" style="color:var(--admin)">Admin</h2>
        <div id="weather_box" style="font-size:10px; color:var(--accent);">Sunny 25Â°C</div>
    </div>
    <div class="nav-tabs">
        <div class="tab" onclick="aTab('staff')">Staff</div>
        <div class="tab" onclick="aTab('tasks')">Tasks</div>
        <div class="tab" onclick="aTab('fin')">Banking</div>
        <div class="tab" onclick="aTab('set')">Settings</div>
    </div>

    <div id="a_staff" class="a-content">
        <div class="glass">
            <h4>Register Worker</h4>
            <input type="text" id="wn" placeholder="Worker Name">
            <input type="text" id="wr" placeholder="Role (e.g. Teacher)">
            <button onclick="addWorker()" class="btn-acc">Register & Create Link</button>
        </div>
        <div id="staff_list"></div>
    </div>

    <div id="a_tasks" class="a-content" style="display:none;">
        <div class="glass">
            <h4>Set Cycle Target</h4>
            <select id="tc"><option>Daily</option><option>Weekly</option><option>Monthly</option><option>Yearly</option></select>
            <textarea id="td" placeholder="Task description..."></textarea>
            <button onclick="saveTask()" class="btn-acc">Deploy</button>
        </div>
    </div>

    <div id="a_fin" class="a-content" style="display:none;">
        <div class="glass"><canvas id="finChart" height="200"></canvas></div>
    </div>
</div>

<div id="workerPage" class="page">
    <h2 id="wrk_title" style="color:var(--worker)">Worker</h2>
    <div class="glass" style="border-color:var(--accent);">
        <h3>GPS Check-In</h3>
        <div id="gps_data" style="font-family:monospace; margin-bottom:10px;">GPS: INACTIVE</div>
        <button onclick="getGPS()" class="btn-acc">Sync Location</button>
    </div>
    <div class="glass">
        <h3>Current Task Progress</h3>
        <div id="wrk_task" style="margin-bottom:15px;">Awaiting instructions...</div>
        <input type="range" id="prog" min="0" max="100" value="0" oninput="document.getElementById('pv').innerText=this.value">
        <p>Progress: <span id="pv">0</span>%</p>
        <button onclick="syncProg()" class="btn-acc" style="background:#444;">Update Admin</button>
    </div>
</div>

<div id="regPage" class="page">
    <div class="glass" style="margin-top:10vh;">
        <h2>Register Org</h2>
        <input type="text" id="ro" placeholder="Org Name">
        <input type="text" id="ru" placeholder="Admin Username">
        <input type="password" id="rp" placeholder="Admin Password">
        <button onclick="regAdmin()" class="btn-acc">Create Account</button>
    </div>
</div>

<script>
    let db = {
        admins: JSON.parse(localStorage.getItem('cx_adm')) || [],
        workers: JSON.parse(localStorage.getItem('cx_wrk')) || [],
        tasks: JSON.parse(localStorage.getItem('cx_tsk')) || [],
        otp: "0000", cur: null
    };

    function nav(id) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        window.scrollTo(0,0);
    }

    function ai(m) {
        const b = document.getElementById('ai_notifier');
        b.innerText = "AI: " + m;
        b.style.display = 'block';
        setTimeout(() => b.style.display='none', 3000);
    }

    // --- AUTH ---
    function getOTP() {
        const u = document.getElementById('l_u').value;
        const p = document.getElementById('l_p').value;
        if(!u || !p) return;
        db.otp = (u === 'Rabi' && p === '3400') ? "3400" : Math.floor(1000 + Math.random() * 9000).toString();
        document.getElementById('otp_display').innerText = db.otp;
        document.getElementById('step1').style.display = 'none';
        document.getElementById('step2').style.display = 'block';
        ai("Security Code Generated");
    }

    function verifyLogin() {
        if(document.getElementById('otp_in').value !== db.otp) return alert("Wrong Code");
        const u = document.getElementById('l_u').value;
        const p = document.getElementById('l_p').value;

        if(u === 'Rabi' && p === '3400') {
            renderMaster();
            nav('creatorPage');
        } else {
            let a = db.admins.find(x => x.u === u && x.p === p);
            let w = db.workers.find(x => x.n === u);
            if(a) { db.cur = a; document.getElementById('adm_title').innerText = a.o; nav('adminPage'); }
            else if(w) { db.cur = w; document.getElementById('wrk_title').innerText = w.n; renderWrkTask(); nav('workerPage'); }
            else alert("User not found");
        }
    }

    // --- ADMIN LOGIC ---
    function regAdmin() {
        db.admins.push({o: document.getElementById('ro').value, u: document.getElementById('ru').value, p: document.getElementById('rp').value, paid: true});
        localStorage.setItem('cx_adm', JSON.stringify(db.admins));
        nav('loginPage');
    }

    function addWorker() {
        const n = document.getElementById('wn').value;
        const link = window.location.href + "?user=" + n; // MISTAKE FIXED: Generates actual link
        db.workers.push({n, r: document.getElementById('wr').value, o: db.cur.o});
        localStorage.setItem('cx_wrk', JSON.stringify(db.workers));
        alert("Worker Registered. Link: " + link);
        renderStaff();
    }

    function saveTask() {
        const t = {o: db.cur.o, c: document.getElementById('tc').value, d: document.getElementById('td').value};
        db.tasks = db.tasks.filter(x => x.o !== db.cur.o); // Overwrite old task
        db.tasks.push(t);
        localStorage.setItem('cx_tsk', JSON.stringify(db.tasks));
        ai("Task Deployed to Workers");
    }

    function aTab(t) {
        document.querySelectorAll('.a-content').forEach(c => c.style.display='none');
        document.getElementById('a_'+t).style.display='block';
        if(t === 'fin') renderChart();
    }

    // --- WORKER LOGIC ---
    function getGPS() {
        navigator.geolocation.getCurrentPosition(p => {
            document.getElementById('gps_data').innerText = `LIVE: ${p.coords.latitude.toFixed(4)}, ${p.coords.longitude.toFixed(4)}`;
            ai("Location Verified");
        });
    }

    function renderWrkTask() {
        const t = db.tasks.find(x => x.o === db.cur.o);
        if(t) document.getElementById('wrk_task').innerHTML = `<b>${t.c} Goal:</b> ${t.d}`;
    }

    function syncProg() {
        ai("Progress Synced: " + document.getElementById('prog').value + "%");
    }

    // --- CREATOR LOGIC ---
    function renderMaster() {
        document.getElementById('master_list').innerHTML = db.admins.map((a, i) => `
            <div class="glass">
                <b>${a.o}</b> (Admin: ${a.u})<br>
                Status: <span style="color:${a.paid?'#0f0':'#f00'}">${a.paid?'PAID':'PENDING'}</span>
                <button onclick="togglePay(${i})" style="width:100px; font-size:10px; height:30px; margin:0; padding:0; float:right;">Toggle Pay</button>
            </div>
        `).join('');
    }

    function togglePay(i) {
        db.admins[i].paid = !db.admins[i].paid;
        localStorage.setItem('cx_adm', JSON.stringify(db.admins));
        renderMaster();
    }

    function renderChart() {
        const ctx = document.getElementById('finChart').getContext('2d');
        new Chart(ctx, {type:'line', data:{labels:['D','W','M','Y'], datasets:[{label:'Ex-Rate', data:[1.2, 1.3, 1.1, 1.5], borderColor:'#00ff88'}]}, options:{color:'#fff'}});
    }
</script>
</body>
                                      </html>       
